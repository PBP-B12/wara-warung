{% load static %}

{% block content %}

<head>
    <style>
        .form-title {
            font-size: 2.5rem;  
            font-weight: bold;
            text-align: center;
            color: #1F1F1F;
            margin-top: 150px;
        }
    
        .form-container {
            width: 100%;
            max-width: 600px;  
        }
    
        .form-row {
            display: flex;
            flex-direction: column;  
            gap: 0.5rem;
            margin-bottom: 1rem; 
        }
    
        .form-row label {
            font-size: 1rem;
            font-weight: 600;
        }
    
        .form-row input {
            width: 100%;
            padding: 0.75rem; 
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;  
        }
    
        .form-row.full-width {
            width: 100%;
        }
    
        .form-row.full-width input {
            width: 100%;
            height: 2.5rem; 
        }
    
        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 1rem;  
            margin-top: 1.5rem;
        }
    </style>    
</head>

<div id="editProfileModal" class="hidden fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
    <div class="form-container bg-white p-8 rounded shadow-md w-full max-w-lg">
        <h2 class="text-2xl font-bold mb-4">Edit Details</h2>
        <form id="editProfileForm" method="POST" action="{% url 'user_dashboard:edit_user' user_entry.id %}">
            {% csrf_token %}
            <div class="form-row">
                <label for="email">Email</label>
                <input type="email" name="email" value="{{ email|default_if_none:'' }}">
            </div>
            <div class="form-row">
                <label for="phone">Phone Number</label>
                <input type="text" name="phone_number" value="{{ phone_number|default_if_none:'' }}">
            </div>
            <div class="form-row">
                <label for="date_of_birth">Date of Birth</label>
                <input type="date" name="date_of_birth" value="{{ date_of_birth|date:'Y-m-d'|default_if_none:'' }}">
            </div>            
            <div class="form-row">
                <label for="address">Address</label>
                <input type="text" name="address" value="{{ address|default_if_none:'' }}">
            </div>
            <div class="button-group mt-4">
                <button type="button" class="info-button" onclick="submitEditForm()">Save Changes</button>
                <button type="button" class="delete-profile-button" onclick="toggleEditProfileModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleEditProfileModal() {
        const modal = document.getElementById("editProfileModal");
        modal.classList.toggle("hidden");
    }

    function submitEditForm() {
        const form = document.getElementById("editProfileForm");
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                document.getElementById("profileEmail").value = data.data.email || 'N/A';
                document.getElementById("profilePhoneNumber").value = data.data.phone_number || 'N/A';
                document.getElementById("profileDateOfBirth").value = data.data.date_of_birth || 'N/A';
                document.getElementById("profileAddress").value = data.data.address || 'N/A';

                toggleEditProfileModal();
            } else {
                console.log(data.errors);
                alert("Failed to update profile. Please check the form fields.");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("An error occurred. Please try again.");
        });
    }
</script>

{% endblock %}